<!DOCTYPE html>
<html>
  <head>
    <title>Documents Structurés</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# Cours 07
## XPATH
### 21/11/2019

---
# XPATH

## Des fonctions

[Liste des fonctions de xpath 2.0](http://www.saxonica.com/html/documentation/functions/fn/)

- `position()`: le numéro du noeud contexte
- `count(arg)`: le nombre de noeuds passé en argument
- `last()`: le nombre de noeuds du contexte
- `name(arg)`: le nom du noeud passé en argument (contient l'espace de nom!)
- `local-name(arg)`: pareil mais sans l'espace de nom
- `not()`: la négation

---
# XPATH

## Des fonctions sur les chaînes de caractères

- `string(arg)`: l'argument est converti en string 
- `concat(args)`: les arguments sont concaténés
- `contains(str1, str2)`: retourne un booléan si `str1` contient `str2`
- `string-length(arg)`: la taille de la chaîne
- `normalize-space()`: supprime les blancs en début et fin de chaîne et les suites d'espace
- `translate(str, motif, remplacement)`: translate("héllò", 'éò', 'eo') -> "hello"

---
# XPATH

## Exercice sur le fichier `juicers.xml`

1. À partir de la racine, afficher le dernier `juicer`
2. À partir de la description du second `juicer`, afficher le dernier noeud ancêtre
3. Compter le total de noeuds du document
4. Afficher les noeuds avec 2 enfants et +
5. Afficher tous les noeuds qui sont en seconde position
6. Trouver le nom de l'elément suivant l'élément `name`
7. Afficher les noeuds textes avec plus de 140 caractères
8. Afficher tous les noeuds `juicer` avec une url en `.html`

---
# XPATH

## Les séquences

Xpath 2.0 introduit la notion de séquence à la place de `nodeset`

Une expression Xpath retourne une séquence

Une séquence est une suite ordonnée de noeuds et/ou de valeurs

Une séquence ne peut pas en contenir une autre (elle sera aplatit)

Les séquences vides sont supprimées

- `('xml', 'xpath', 'xslt')`
- `(21, 10, 2019)`
- `('xml', 'xpath', 'xslt', 21, 10, 2019)`
- `(//juicer/name)`
- `()`: une séquence vide
- `('')`: une séquence avec une chaîne vide

---
# XPATH - Séquences

Il est possible de

- d'extraire un objet : `('a', 'b', 'c')[2] -> 'b'`
- d'obtenir la taille : `count(('a', 'b', 'c')) -> 3`
- de faire la somme des objets la composant : `sum((1,2,3)) -> 6`
- d'obtenir la moyenne avec `avg`
- d'obtenir la plus petite valeur avec `min`
- d'obtenir la plus grande valeur avec `max`

Le noeud contexte est représenté par le point `.`
- pour élimer les chaînes vides : `('a', '', 'b', '', 'c')[.] -> ('a', 'b', 'c')
- appliquer une fonction ou une évaluation `(1,2,3,4,5)[. > 3] -> (4,5)
- très utile en xslt !

Créer une séquence d'entier `(x to y)`

---
# XPATH - Séquences

Quelques fonctions

- `index-of(seq, objet)`: trouver la position de `objet` dans `seq`
- `remove(seq, position)`: supprimer l'objet à la `position`
- `insert-before(seq, objet, position)`: ajoute `l'objet` avant la position indiquée
- pour ajouter après, `insert-before(seq, objet, position > len de la seq)`
- `reverse(seq)`: retourne la séquence

---
# XPATH - Séquences

## Exercice sur le fichier `juicers.xml`

Adaptation du powerpoint de Roger Costello

1. Créer une séquence contenant les `juicer` de type centrifugeuse
2. Sélectionner la dernière machine à partir de cette séquence
3. Supprimer la deuxième machine de cette séquence
4. Créer une séquence du nom des machines, la séquence doit contenir des chaînes de caractères
5. Afficher la position de `Juiceman Jr.` à partir de cette séquence
6. Créer une séquence avec les noeuds contenant le nom des machines
7. Afficher la position du noeud contenant `Juiceman Jr.` à partir de cette séquence

8. Créer une séquence d'entier allant de 5 à 25
10 Afficher tous les multiples de 5 de cette séquence


    </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>


